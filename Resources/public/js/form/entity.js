define(["jquery","ekyna-modal","ekyna-form","ekyna-table"],function(a,b,c,d){"use strict";return a.fn.entityWidget=function(){return this.each(function(){var c=a(this),e=c.find("button.new-resource"),f=c.find("button.list-resource"),g=c.find("select");1==e.length&&e.bind("click",function(){var c=new b;c.load({url:e.data("path")}),a(c).on("ekyna.modal.content",function(b){if("data"==b.contentType){var c=b.content,d=a("<option />");if(d.prop("value",c.id),d.prop("selected",!0),void 0!=c.name)d.html(c.name);else{if(void 0==c.title)throw"Unexpected resource data.";d.html(c.title)}g.append(d).select2()}})}),1==f.length&&f.bind("click",function(){var c=new b;c.load({url:f.data("path")}),a(c).on("ekyna.modal.content",function(b){if("table"!=b.contentType)throw"Expected modal content type = 'table'.";d.create(b.content,{ajax:!0,onSelection:function(b){g.prop("multiple")&&g.find("option").prop("selected",!1),a(b).each(function(b,c){var d=g.find("option[value="+c.id+"]");1==d.length?d.prop("selected",!0):(d=a("<option />"),d.prop("value",c.id),d.prop("selected",!0),void 0!=c.name?d.html(c.name):void 0!=c.title?d.html(c.title):d.html("Entity #"+c.id),g.append(d))}),g.select2(),c.getDialog().close()}})})})}),this},{init:function(a){a.entityWidget()}}});